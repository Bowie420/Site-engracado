<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Game</title>
</head>
<body>
    <h1>Welcome to the Game</h1>
    <iframe id="spotify-embed" width="300" height="380" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
    <button id="btn1"></button>
    <button id="btn2"></button>
    <button id="btn3"></button>
    <button id="btn4"></button>
    <div id="result"></div>

    <script>
        // Function to get the query parameter from the URL
        function getQueryParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // Get the access token from the URL
        const accessToken = getQueryParam('access_token');

        const genreList = ["acoustic", "afrobeat", "alt-rock", "alternative", "ambient", "anime", "black-metal", "bluegrass", "blues", "bossanova", "brazil", "breakbeat", "british", "cantopop", "chicago-house", "children", "chill", "classical", "club", "comedy", "country", "dance", "dancehall", "death-metal", "deep-house", "detroit-techno", "disco", "disney", "drum-and-bass", "dub", "dubstep", "edm", "electro", "electronic", "emo", "folk", "forro", "french", "funk", "garage", "german", "gospel", "goth", "grindcore", "groove", "grunge", "guitar", "happy", "hard-rock", "hardcore", "hardstyle", "heavy-metal", "hip-hop", "holidays", "honky-tonk", "house", "idm", "indian", "indie", "indie-pop", "industrial", "iranian", "j-dance", "j-idol", "j-pop", "j-rock", "jazz", "k-pop", "kids", "latin", "latino", "malay", "mandopop", "metal", "metal-misc", "metalcore", "minimal-techno", "movies", "mpb", "new-age", "new-release", "opera", "pagode", "party", "philippines-opm", "piano", "pop", "pop-film", "post-dubstep", "power-pop", "progressive-house", "psych-rock", "punk", "punk-rock", "r-n-b", "rainy-day", "reggae", "reggaeton", "road-trip", "rock", "rock-n-roll", "rockabilly", "romance", "sad", "salsa", "samba", "sertanejo", "show-tunes", "singer-songwriter", "ska", "sleep", "songwriter", "soul", "soundtracks", "spanish", "study", "summer", "swedish", "synth-pop", "tango", "techno", "trance", "trip-hop", "turkish", "work-out", "world-music"]
;

        document.addEventListener('DOMContentLoaded', () => {
            loadRandomSong();
        });

        function loadRandomSong() {
            fetchRandomSong().then(data => {
                const songUrl = data.url;
                const correctGenre = data.genre;
                const genres = shuffleArray([correctGenre, ...getRandomGenres(correctGenre)]);

                console.log(data)

              //  document.getElementById('spotify-embed').src = songUrl;
              //  document.getElementById('btn1').textContent = genres[0];
                //document.getElementById('btn2').textContent = genres[1];
             //   document.getElementById('btn3').textContent = genres[2];
            //    document.getElementById('btn4').textContent = genres[3];

              //  document.getElementById('btn1').onclick = () => checkAnswer(genres[0], correctGenre);
               // document.getElementById('btn2').onclick = () => checkAnswer(genres[1], correctGenre);
                //document.getElementById('btn3').onclick = () => checkAnswer(genres[2], correctGenre);
                //document.getElementById('btn4').onclick = () => checkAnswer(genres[3], correctGenre);
            });
        }

        async function fetchRandomSong() {
            try {
                // Use random seeds for the recommendations endpoint
                const randomGenres = genreList[Math.floor(Math.random() * genreList.length)];
                console.log(randomGenres);
                const response = await fetch(`https://api.spotify.com/v1/recommendations?seed_genres=${randomGenres}`, {
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    }
                });
                const data = await response.json();
                const track = data.tracks[0]; // Take the first recommended track
                const songUrl = `https://open.spotify.com/embed/track/${track.id}`;
                const genre = randomGenres; // Use the seed genre as the genre

                return { url: songUrl, genre };
            } catch (error) {
                console.error('Error fetching song:', error);
                return { url: '', genre: '' };
            }
        }

        function getRandomGenres(correctGenre) {
            const filteredGenres = genreList.filter(genre => genre !== correctGenre);
            return shuffleArray(filteredGenres).slice(0, 3);
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function checkAnswer(selectedGenre, correctGenre) {
            const resultDiv = document.getElementById('result');
            if (selectedGenre === correctGenre) {
                resultDiv.textContent = 'Correct! The genre is ' + correctGenre;
            } else {
                resultDiv.textContent = 'Wrong! The correct genre was ' + correctGenre;
            }
            setTimeout(() => {
                resultDiv.textContent = '';
                loadRandomSong();
            }, 3000);
        }
    </script>
</body>
</html>